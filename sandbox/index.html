<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" />
		<link rel="stylesheet" href="../www/css/jquery.mobile-1.3.2.css" />
		<style type="text/css">
			#mapDiv{
				height: 300px;
			}
			#overlay{
				height: 200px;
			}
		</style>
		
		


		<script src="../www/js/jquery.js"></script>
		<script src="../www/js/jquery.mobile-1.3.2.min.js"></script>
		


		<!-- Gmaps imports-->
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
		<script type="text/javascript" src="../www/js/gmaps.js"></script>
		<link rel="stylesheet" href="http://twitter.github.com/bootstrap/1.3.0/bootstrap.min.css" />


		<title>Technion Map</title>
	</head> 
	<body>
		<!-- debug log -->
		<script>
			var log = {
				outlet: "#logData",

				error: function (data) {
					this.log("ERROR", data);
				},
				info: function (data) {
					this.log("INFO", data);
				},

				log: function (info, data) {
					$(this.outlet).append(info + ": ").append(data).append("<br/>");
				}
			};


		</script>

		<div data-role="page" id="login" data-theme="b">
			<div data-role="content">
				<div id="userData">
				</div>
				<div>
					<div id="mapDiv"></div>
					<button id="friendsButton">Data</button>
				</div>
				<div>
					<h3>Position</h3>
					<p id="cur_position"></p>
				</div>
				<div>
					<h3>log</h3>
					<p id="logData"></p>
				</div>
				<!-- Msgs -->
			  <div data-role="popup" datd-theme="e" id="noNetwork">
					<p>No network connection detected.<br>You have to be online.</p>
				</div>
			</div>
			<div data-role="footer">(c) Technion foursquare</div>
		</div>


		<!-- ------------------------------------------------------------------------------ -->
		
		

		<script type="text/javascript">
			var me = {};

			function User(loc, id, name, picUrl){
				this.loc = loc;
				this.id = id;
				this.name = name;
				this.pic = picUrl;
			};

			var map;



			$(document).ready( function ()
			{
				geoLocation.get();

				$('#friendsButton').click(function(){
					var friendData = new User({lat: position.lat - 0.0002, lng: position.lng + 0.002}, "554861654", "Avichai Rubin", "https://fbcdn-profile-a.akamaihd.net/hprofile-ak-prn2/t1.0-1/c0.3.50.50/p50x50/1509892_10152077195916655_1008896354_t.jpg" );
					addMarker(friendData);
				});


				//  Gmaps init
				initMap();
				map.drawOverlay({
				  	lat: geoLocation.campus_lat,
					lng: geoLocation.campus_lng,
				  content: '<img id="overlay" src="../www/img/technion_campus.gif" />'
				});
								
			}); // end of document.ready



			function initMap(){
				map = new GMaps({
					el: '#mapDiv',
					lat: geoLocation.campus_lat,
					lng: geoLocation.campus_lng,
					zoom:16,
					panControl : false,
					scaleControl : false,
					scrollwheel : false,
					zoomControl : false,
					streetViewControl: false,
					mapTypeControl: false,
					draggable: false
				});		
			};

			function addMarker(user){
				console.log(user);
				map.addMarker({
					lat: user.loc.lat,
					lng: user.loc.lng,
					title: 'Lima',
					icon: {
						url: user.pic,
						scaledSize: {
							width: 50,
							height: 50
						}
					},
  					//shadow: 'schools_maps.shadow.png',
					details: {
						database_id: 42,
						author: 'HPNeo'
					},
					click: function() {
						markerClick(user);
					}
				});
			}

			function markerClick(user){
				log.info(user.name);
			}



			var position = {
			    lng: "undef",
			    lat: "undef"
			};

			var geoLocation = {
			    campus_lng: 35.2264997,
			    campus_lat: 31.654524800000003,
			    get : function() {
			        log.info("fetching geolocation");
			        navigator.geolocation.getCurrentPosition(this.onSuccsess, this.onError);
			    },
			    onSuccsess : function(pos) {    
			        //data with map 
			            
			            position.lng = pos.coords.longitude;
			            position.lat = pos.coords.latitude;

			            log.info(position.lat);

			            var text = "<div>Latitude: " + pos.coords.latitude + 
			                        "<br/>" + "Longitude: " + pos.coords.longitude + "<br/>" + 
			                        "Accuracy: " + pos.coords.accuracy + "m<br/>" + "</div>";
			            $("#cur_position").html(text);
			            
			            
			           

			    },
			    onError : function(error) {
			        log.error('code: '    + error.code    + '\n' +
			              'message: ' + error.message + '\n');
			    }
			};
		</script>



	</body>
</html>
